var R=Object.defineProperty;var S=(s,e,t)=>e in s?R(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var f=(s,e,t)=>(S(s,typeof e!="symbol"?e+"":e,t),t);import{d as b,a as E,r as p,b as _,e as $,o as g,c as h,f as l,t as d,u as O,g as w,h as I,F as k,i as D}from"./index-4e5a1776.js";const j={baseUrl:"",timeout:5e3},N=s=>{const e=[];return Object.entries(s).forEach(([t,n])=>{const r=encodeURIComponent(t);if(n!=null)switch(typeof n){case"string":case"number":e.push(`${r}=${encodeURIComponent(n)}`);return;case"bigint":e.push(`${r}=${encodeURIComponent(n.toString())}`);return;case"boolean":n===!0&&e.push(r);return;default:throw new TypeError("Invalid query parameter")}}),e.length?`?${e.join("&")}`:""},q=async(s,e={})=>{const t=e.headers||{};e.headers={accept:"application/json",...t};const n=await x(s,e);try{return{data:await n.json(),response:n}}catch(r){throw new m(r,n)}},x=async(s,e={})=>{const{baseUrl:t,headers:n,params:r}={...j,...e};let o;try{const u=e.fetch??fetch,c=r?`${t}${s}${N(r)}`:`${t}${s}`;o=await u(c,{headers:n})}catch(u){throw new m(u,o)}if(!(o!=null&&o.ok))throw new m(new Error("Response not OK"),o);return o};class m extends Error{constructor(t,n){var e=(...args)=>{super(...args);f(this,"error");f(this,"response")};t.name==="TypeError"?(e("Error fetching resource"),this.name="RequestNetworkError"):(e(t.message),this.name="RequestError"),this.error=t,this.response=n}}const v=async(s,e={})=>{const t=await q(s,{baseUrl:"https://environment.data.gov.uk/flood-monitoring",...e});return[t.data.items,t]},y=(s,e=0)=>{let t=s.lastIndexOf("/");for(;e>0;--e)t=s.lastIndexOf("/",t);return s.substring(t+1)},C=(s,e)=>{const t={};return Object.entries(e).forEach(([n,r])=>{if(r===!0){const a=s[n];if(a==null)return;t[n]=a;return}if(typeof r=="string"){const a=s[r];if(a==null)return;t[n]=a;return}const[o,u]=r,c=u(s[o]);c!=null&&(t[n]=c)}),t},U=async s=>{const[e,t]=await v(`/id/stations/${s}`);return[C(e,T),t]},T={id:["@id",s=>y(s)],RLOIid:!0,catchmentName:!0,dateOpened:!0,datumOffset:!0,downstageScale:!0,eaAreaName:!0,eaRegionName:!0,easting:!0,label:!0,lat:!0,long:!0,measures:!0,northing:!0,notation:!0,riverName:!0,stageScale:!0,stationReference:!0,status:!0,statusReason:!0,statusDate:!0,town:!0,type:!0,wiskiID:!0},A={limit:1e3},B=async(s,e={})=>{const t={...A,...e},{ascending:n,descending:r,since:o,limit:u}=t,c={since:o,_limit:u};(o||n||r)&&(c._sorted=!0);const[a,i]=await v(`/id/stations/${s}/readings`,{params:c});return[F(a,{ascending:n,descending:r}),i]},F=(s,e={})=>{const t=s,n={};t.forEach(({measure:c,dateTime:a,value:i})=>{n[c]=n[c]||[],n[c].push([new Date(a).valueOf(),i])});const r={};Object.entries(n).forEach(([c,a])=>{const i=y(c);r[i]=a});const{ascending:o,descending:u}=e;if(o||u){const c=o?([a],[i])=>a-i:([a],[i])=>i-a;Object.values(r).forEach(a=>{a.sort(c)})}return r},V=b("station",()=>({getStation:async t=>{const[n,r]=await U(t);return[n,r]},getStationReadings:async(t,n={})=>{const[r,o]=await B(t,n);return[r,o]}})),P={key:0},G={key:1},z=E({__name:"StationPage",setup(s){const e=V(),t=D(),n=p(null),r=p({}),o=_(()=>{const a=t.params.id;return Array.isArray(a)?a[0]:a}),u=p();$(async()=>{const[a,{data:i}]=await e.getStation(o.value);n.value=a,r.value=i});const c=async()=>{const[a]=await e.getStationReadings(o.value,{since:new Date(Date.now()-864e5).toISOString(),ascending:!0});u.value=a};return(a,i)=>(g(),h(k,null,[l("div",null,"Station id "+d(O(o)),1),l("div",null,[l("button",{onClick:c},"Get Readings")]),u.value?(g(),h("div",P,[l("pre",null,d(u.value),1)])):w("",!0),l("pre",null,d(r.value),1),n.value?(g(),h("div",G,[l("h1",null,[I(d(n.value.label)+" ",1),l("small",null,"("+d(n.value.id)+")",1)]),l("pre",null,d(n.value),1)])):w("",!0),l("pre",null,d(r.value),1)],64))}});export{z as default};
